# Configuration site par défaut PhishGuard
# ========================================

# Redirection HTTP vers HTTPS (production)
server {
    listen 80;
    listen [::]:80;
    server_name phishguard.votre-domaine.com;
    
    # Permettre Let's Encrypt
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
        allow all;
    }
    
    # Redirection HTTPS
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# Configuration commune (incluse dans nginx.conf)
# phishguard-common.conf
location /favicon.ico {
    access_log off;
    log_not_found off;
    expires 30d;
}

location /robots.txt {
    access_log off;
    log_not_found off;
    return 200 "User-agent: *\nDisallow: /\n";
    add_header Content-Type text/plain;
}

# Endpoint pour les webhooks (si nécessaire)
location /webhook {
    limit_req zone=api burst=5 nodelay;
    
    try_files $uri $uri/ =404;
    
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_pass php-fpm;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
        
        # Log des webhooks
        access_log /var/log/nginx/webhook.log security;
    }
}
